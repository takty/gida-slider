{"version":3,"sources":["hero.js"],"names":["window","GIDA","slider_hero_initialize","id","opts","NS","CLS_DISPLAY","CLS_VIEW","root","document","getElementById","getElementsByClassName","undefined","effectType","timeDur","timeTran","randomTiming","slides","Array","prototype","slice","call","querySelectorAll","size","length","pics","effect","onTransitionEnd","hasVideo","resizeListeners","asyncTimeout","ms","fn","res","tid","set","Promise","r","setTimeout","async","clear","clearTimeout","addEventListener","opt","navigator","userAgent","toLowerCase","indexOf","passive","i","TransitionSlide","constructor","tranTime","this","_size","_sls","_time","style","transform","opacity","transition","[object Object]","idx","dir","TransitionScroll","_curIdx","_curIdxPsd","_curPos","_calcPosition","d","tf","shift","Math","floor","curPos","time","pos","t","abs","idxPsd","sizePsd","hs","ceil","rs","j","TransitionFade","pointerEvents","CLS_DUAL","CLS_SCROLL","PictureImage","sl","p","createElement","classList","add","contains","imgs","appendChild","dataset","img","_createImage","imgSrcset","imgSub","imgSubSrcset","src","srcset","getElement","isCur","display","remove","getDuration","doRandom","dt","random","PictureVideo","vs","v","_initializeVideo","video","s","setAttribute","muted","playsinline","ar","clientWidth","clientHeight","play","pause","currentTime","duration","onResize","arFrame","isVideo","onResizeVideo","finish","scroll","insertBefore","firstChild","push","doFirst","isRunning","run","requestAnimationFrame","throttle","initImages","IntersectionObserver","es","e","isIntersecting","rootMargin","observe","tryResizeVideo","curIdx","stStep","last","getIdxDir","performance","now","step","next","previous"],"mappings":"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","file":"hero.min.js","sourcesContent":["/**\n *\n * Gida Slider - Hero (JS)\n *\n * @author Takuto Yanagida\n * @version 2021-06-29\n *\n */\n\n\nwindow.GIDA = window['GIDA'] ?? {};\n\n\nwindow.GIDA.slider_hero_initialize = function (id, opts) {\n\tconst NS          = 'gida-slider-hero';\n\tconst CLS_SLIDES  = NS + '-slides';\n\tconst CLS_VISIBLE = 'visible';\n\tconst CLS_DISPLAY = 'display';\n\tconst CLS_VIEW    = 'view';\n\tconst CLS_PAUSE   = 'pause';\n\tconst OFFSET_VIEW = 100;\n\n\tconst root = id ? document.getElementById(id) : document.getElementsByClassName(NS)[0];\n\tif (!root) return;\n\n\tif (opts === undefined) opts = {};\n\tconst effectType   = opts['effect_type']      ?? 'slide';\n\tconst timeDur      = opts['duration_time']    ?? 8;  // [second]\n\tconst timeTran     = opts['transition_time']  ?? 1;  // [second]\n\tconst randomTiming = opts['is_random_timing'] ?? false;\n\n\tconst slides = Array.prototype.slice.call(root.querySelectorAll(`.${CLS_SLIDES} > li`));\n\tconst size   = slides.length;\n\tconst pics   = [];\n\tlet effect   = null;\n\n\tlet onTransitionEnd = null;\n\tlet hasVideo        = false;\n\n\n\t// -------------------------------------------------------------------------\n\n\n\t/**\n\t *\n\t * Common Functions (JS)\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-06-25\n\t *\n\t */\n\t\n\t\n\tconst resizeListeners = [];\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\tconst ua = window.navigator.userAgent.toLowerCase();\n\t\tconst isIe = (ua.indexOf('trident/7') !== -1);\n\t\n\t\tconst opt = (isIe === 'ie11') ? false : { passive: true };\n\t\twindow.addEventListener('resize', () => { for (let i = 0; i < resizeListeners.length; i += 1) resizeListeners[i](); }, opt);\n\t});\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t\n\t\tfunction throttle(fn) {\n\t\t\tlet isRunning;\n\t\t\tfunction run() {\n\t\t\t\tisRunning = false;\n\t\t\t\tfn();\n\t\t\t}\n\t\t\treturn () => {\n\t\t\t\tif (isRunning) return;\n\t\t\t\tisRunning = true;\n\t\t\t\trequestAnimationFrame(run);\n\t\t\t};\n\t\t}\n\t}\n\t\n\tfunction asyncTimeout(ms, fn = () => { }) {\n\t\tlet tid = null;\n\t\tlet res;\n\t\treturn {\n\t\t\tset: () => new Promise((r) => {\n\t\t\t\tres = r\n\t\t\t\ttid = setTimeout(async () => {\n\t\t\t\t\ttid = null;\n\t\t\t\t\tawait fn();\n\t\t\t\t\tr();\n\t\t\t\t}, ms);\n\t\t\t}),\n\t\t\tclear: () => {\n\t\t\t\tif (tid) {\n\t\t\t\t\tclearTimeout(tid);\n\t\t\t\t\ttid = null;\n\t\t\t\t\tres();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\t\n\t/**\n\t *\n\t * Slide Transition\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-06-25\n\t *\n\t */\n\t\n\t\n\tclass TransitionSlide {\n\t\n\t\tconstructor(size, slides, tranTime) {\n\t\t\tthis._size = size;\n\t\t\tthis._sls  = slides;\n\t\t\tthis._time = tranTime;\n\t\n\t\t\tfor (let i = 0; i < this._size; i += 1) {\n\t\t\t\tthis._sls[i].style.transform = 'translateX(' + (i ? 100 : 0) + '%)';\n\t\t\t}\n\t\t\tsetTimeout(() => {\n\t\t\t\tfor (let i = 0; i < this._size; i += 1) {\n\t\t\t\t\tthis._sls[i].style.opacity = 1;\n\t\t\t\t\tthis._sls[i].style.transition = 'transform ' + this._time + 's';\n\t\t\t\t}\n\t\t\t}, 10);\n\t\t}\n\t\n\t\tasync transition(idx, dir) {\n\t\t\tfor (let i = 0; i < this._size; i += 1) {\n\t\t\t\tthis._sls[i].style.transform = (i <= idx) ? 'translateX(0%)' : 'translateX(100%)';\n\t\t\t}\n\t\t\tawait asyncTimeout(this._time * 1000).set();\n\t\t}\n\t\n\t}\n\t\n\t/**\n\t *\n\t * Scroll Transition\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-06-29\n\t *\n\t */\n\t\n\t\n\tclass TransitionScroll {\n\t\n\t\tconstructor(size, slides, tranTime) {\n\t\t\tthis._size      = size;\n\t\t\tthis._sls       = slides;\n\t\t\tthis._time      = tranTime;\n\t\t\tthis._curIdx    = 0;\n\t\t\tthis._curIdxPsd = 0;\n\t\t\tthis._curPos    = this._calcPosition(0, 1);\n\t\n\t\t\tfor (let i = 0; i < this._sls.length; i += 1) {\n\t\t\t\tthis._sls[i].style.opacity = 1;\n\t\t\t\tthis._sls[i].style.transform = `translateX(${this._curPos[i] * 100}%)`;\n\t\t\t}\n\t\t}\n\t\n\t\tasync transition(idx, dir) {\n\t\t\tthis._curPos = this._calcPosition(this._curIdxPsd, dir);\n\t\t\tfor (let i = 0; i < this._sls.length; i += 1) {\n\t\t\t\tthis._sls[i].style.transition = '';\n\t\t\t\tthis._sls[i].style.transform  = 'translateX(' + 100 * this._curPos[i] + '%)';\n\t\t\t}\n\t\t\tawait asyncTimeout(10).set();  // Wait\n\t\n\t\t\tlet d = 0;\n\t\t\tif (dir ===  1) d = idx - this._curIdx;\n\t\t\tif (dir === -1) d = this._curIdx - idx;\n\t\t\tif (d < 0) d += this._size;\n\t\n\t\t\tfor (let i = 0; i < d; i += 1) {\n\t\t\t\tconst tf = (d === 1) ? 'ease' : ((i === 0) ? 'ease-in' : ((i === d - 1) ? 'ease-out' : 'linear'));\n\t\t\t\tthis._curPos = this.shift(this._curPos, dir, this._time / d, tf);\n\t\t\t\tawait asyncTimeout(Math.floor(this._time * 1000 / d)).set();\n\t\t\t}\n\t\t\tthis._curIdx = idx;\n\t\t}\n\t\n\t\tshift(curPos, dir, time, tf = 'ease') {\n\t\t\tthis._curIdxPsd += dir;\n\t\t\tif (this._sls.length - 1 < this._curIdxPsd) this._curIdxPsd = 0;\n\t\t\tif (this._curIdxPsd < 0) this._curIdxPsd = this._sls.length - 1;\n\t\n\t\t\tconst pos = this._calcPosition(this._curIdxPsd, dir);\n\t\n\t\t\tfor (let i = 0; i < this._sls.length; i += 1) {\n\t\t\t\tconst t = (Math.abs(curPos[i] - pos[i]) === 1) ? `transform ${time}s ${tf}` : '';\n\t\t\t\tthis._sls[i].style.transition = t;\n\t\t\t\tthis._sls[i].style.transform  = `translateX(${100 * pos[i]}%)`;\n\t\t\t}\n\t\t\treturn pos;\n\t\t}\n\t\n\t\t_calcPosition(idxPsd, dir) {\n\t\t\tconst sizePsd = this._sls.length;\n\t\t\tconst pos = new Array(sizePsd);\n\t\t\tpos[idxPsd] = 0;\n\t\t\tconst hs = (dir !== -1) ? Math.ceil((sizePsd - 1) / 2) : Math.floor((sizePsd - 1) / 2);\n\t\t\tconst rs = sizePsd - 1 - hs;\n\t\t\tfor (let i = 1; i <= hs; i += 1) {\n\t\t\t\tlet j = idxPsd + i;\n\t\t\t\tif (sizePsd - 1 < j) j -= sizePsd;\n\t\t\t\tpos[j] = i;\n\t\t\t}\n\t\t\tfor (let i = 1; i <= rs; i += 1) {\n\t\t\t\tlet j = idxPsd - i;\n\t\t\t\tif (j < 0) j += sizePsd;\n\t\t\t\tpos[j] = -i;\n\t\t\t}\n\t\t\treturn pos;\n\t\t}\n\t\n\t}\n\t\n\t/**\n\t *\n\t * Fade Transition\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-06-25\n\t *\n\t */\n\t\n\t\n\tclass TransitionFade {\n\t\n\t\tconstructor(size, slides, tranTime) {\n\t\t\tthis._size = size;\n\t\t\tthis._sls  = slides;\n\t\t\tthis._time = tranTime;\n\t\n\t\t\tfor (let i = 0; i < this._size; i += 1) {\n\t\t\t\tthis._sls[i].style.opacity = (i === 0) ? 1 : 0;\n\t\t\t}\n\t\t\tsetTimeout(() => {\n\t\t\t\tfor (let i = 0; i < this._size; i += 1) {\n\t\t\t\t\tthis._sls[i].style.transition = 'opacity ' + this._time + 's';\n\t\t\t\t}\n\t\t\t}, 10);\n\t\t}\n\t\n\t\tasync transition(idx, dir) {\n\t\t\tfor (let i = 0; i < this._size; i += 1) {\n\t\t\t\tthis._sls[i].style.opacity = (i === idx) ? 1 : 0;\n\t\t\t\tthis._sls[i].style.pointerEvents = (i === idx) ? 'auto' : 'none';\n\t\t\t}\n\t\t\tawait asyncTimeout(this._time * 1000).set();\n\t\t}\n\t}\n\t\n\t/**\n\t *\n\t * Image Picture\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-06-28\n\t *\n\t */\n\t\n\t\n\tconst CLS_PIC    = NS + '-picture';\n\tconst CLS_DUAL   = 'dual';\n\tconst CLS_SCROLL = 'scroll';\n\t\n\tconst RANDOM_RATE = 10;\n\t\n\tclass PictureImage {\n\t\n\t\tconstructor(sl) {\n\t\t\tconst p = document.createElement('div');\n\t\t\tp.classList.add(CLS_PIC);\n\t\t\tif (sl.classList.contains(CLS_SCROLL)) p.classList.add(CLS_SCROLL);\n\t\n\t\t\tconst imgs = sl.querySelectorAll(':scope > img');\n\t\t\tif (imgs.length) {\n\t\t\t\tp.appendChild(imgs[0]);\n\t\t\t\tif (1 < imgs.length) {\n\t\t\t\t\tp.classList.add(CLS_DUAL);\n\t\t\t\t\tp.appendChild(imgs[1]);\n\t\t\t\t}\n\t\t\t} else if (sl.dataset.img) {\n\t\t\t\tp.appendChild(this._createImage(sl.dataset.img, sl.dataset.imgSrcset ?? null));\n\t\t\t\tif (sl.dataset.imgSub) {\n\t\t\t\t\tp.classList.add(CLS_DUAL);\n\t\t\t\t\tp.appendChild(this._createImage(sl.dataset.imgSub, sl.dataset.imgSubSrcset ?? null));\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.p = p;\n\t\t}\n\t\n\t\t_createImage(src, srcset) {\n\t\t\tconst img = document.createElement('img');\n\t\t\timg.src = src;\n\t\t\tif (srcset) img.srcset = srcset;\n\t\t\treturn img;\n\t\t}\n\t\n\t\tgetElement() {\n\t\t\treturn this.p;\n\t\t}\n\t\n\t\ttransition(isCur, size) {\n\t\t}\n\t\n\t\tdisplay(isCur) {\n\t\t\tif (isCur) {\n\t\t\t\tthis.p.classList.add(CLS_DISPLAY);\n\t\t\t} else {\n\t\t\t\tthis.p.classList.remove(CLS_DISPLAY);\n\t\t\t}\n\t\t}\n\t\n\t\tgetDuration(timeDur, timeTran, doRandom) {\n\t\t\tif (!doRandom) return timeDur;\n\t\t\treturn dt * (1 + 0.01 * RANDOM_RATE * (1 - Math.random() * 2));\n\t\t}\n\t\n\t}\n\t\n\t/**\n\t *\n\t * Image Video\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-06-29\n\t *\n\t */\n\t\n\t\n\tconst CLS_VIDEO = NS + '-video';\n\t\n\tclass PictureVideo {\n\t\n\t\tconstructor(sl) {\n\t\t\tconst p = document.createElement('div');\n\t\t\tp.classList.add(CLS_VIDEO);\n\t\n\t\t\tconst vs = sl.querySelectorAll(':scope > video');\n\t\t\tif (1 === vs.length) {\n\t\t\t\tconst v = vs[0];\n\t\t\t\tthis._initializeVideo(v);\n\t\t\t\tthis.v = p.appendChild(v);\n\t\t\t} else if (sl.dataset.video) {\n\t\t\t\tconst v = document.createElement('video');\n\t\t\t\tthis._initializeVideo(v);\n\t\t\t\tthis.v = p.appendChild(v);\n\t\n\t\t\t\tconst s = document.createElement('source');\n\t\t\t\ts.setAttribute('src', sl.dataset.video);\n\t\t\t\tv.appendChild(s);\n\t\t\t}\n\t\t\tthis.p = p;\n\t\t}\n\t\n\t\t_initializeVideo(v) {\n\t\t\tv.muted = true;\n\t\t\tv.playsinline = true;\n\t\t\tv.setAttribute('muted', true);\n\t\t\tv.setAttribute('playsinline', true);\n\t\t\tv.addEventListener('loadedmetadata', () => {\n\t\t\t\tconst ar = v.clientWidth / v.clientHeight;\n\t\t\t\tthis.ar = (0 | (ar * 1000)) / 1000;\n\t\t\t});\n\t\t}\n\t\n\t\tgetElement() {\n\t\t\treturn this.p;\n\t\t}\n\t\n\t\ttransition(isCur, size) {\n\t\t\tif (isCur) {\n\t\t\t\tthis.v.setAttribute('autoplay', true);\n\t\t\t\tthis.v.play();\n\t\t\t\tif (size === 1) this.v.setAttribute('loop', true);\n\t\t\t}\n\t\t}\n\t\n\t\tdisplay(isCur) {\n\t\t\tif (!isCur) {\n\t\t\t\tthis.v.pause();\n\t\t\t\tthis.v.currentTime = 0;\n\t\t\t}\n\t\t}\n\t\n\t\tgetDuration(timeDur, timeTran, doRandom) {\n\t\t\treturn this.v.duration - timeTran;\n\t\t}\n\t\n\t\tonResize() {\n\t\t\tif (!this.ar) return false;\n\t\t\tconst arFrame = this.p.clientWidth / this.p.clientHeight;\n\t\t\tif (this.ar < arFrame) {\n\t\t\t\tthis.v.classList.remove('height');\n\t\t\t\tthis.v.classList.add('width');\n\t\t\t} else {\n\t\t\t\tthis.v.classList.remove('width');\n\t\t\t\tthis.v.classList.add('height');\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\n\t}\n\t\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tinitImages();\n\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\tconst io = new IntersectionObserver((es) => {\n\t\t\tfor (const e of es) root.classList[e.isIntersecting ? 'add' : 'remove'](CLS_VIEW);\n\t\t}, { rootMargin: `${OFFSET_VIEW}px 0px` });\n\t\tio.observe(root);\n\n\t\ttransition(0, 0);\n\t});\n\tif (hasVideo) setTimeout(tryResizeVideo, 100);\n\tfunction tryResizeVideo() {\n\t\tconst finish = onResizeVideo();\n\t\tif (!finish) setTimeout(tryResizeVideo, 100);\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tfunction initImages() {\n\t\tconst scroll = root.classList.contains(CLS_SCROLL);\n\t\tfor (const sl of slides) {\n\t\t\tif (scroll) sl.classList.add(CLS_SCROLL);\n\n\t\t\tsl.style.opacity = 0;  // for avoiding flickering slides on page loading\n\t\t\tlet p = null;\n\t\t\tif (isVideo(sl)) {\n\t\t\t\tp = new PictureVideo(sl);\n\t\t\t\thasVideo = true;\n\t\t\t} else {\n\t\t\t\tp = new PictureImage(sl);\n\t\t\t}\n\t\t\tsl.insertBefore(p.getElement(), sl.firstChild);\n\t\t\tpics.push(p);\n\t\t}\n\t\tif (hasVideo) onResize(onResizeVideo);\n\t\tswitch (effectType) {\n\t\t\tcase 'slide' : effect = new TransitionSlide(size, slides, timeTran); break;\n\t\t\tcase 'scroll': effect = new TransitionScroll(size, slides, timeTran); break;\n\t\t\tcase 'fade'  : effect = new TransitionFade(size, slides, timeTran); break;\n\t\t\tdefault      : effect = new TransitionSlide(size, slides, timeTran); break;\n\t\t}\n\t}\n\n\tfunction isVideo(sl) {\n\t\tif (sl.dataset.video) return true;\n\t\tconst vs = sl.querySelectorAll(':scope > video');\n\t\treturn 0 < vs.length;\n\t}\n\n\tfunction onResizeVideo() {\n\t\tlet finish = true;\n\t\tfor (let i = 0; i < size; i += 1) {\n\t\t\tconst p = pics[i];\n\t\t\tif (p instanceof PictureVideo) {\n\t\t\t\tif (!p.onResize()) finish = false;\n\t\t\t}\n\t\t}\n\t\treturn finish;\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tlet curIdx = 0;\n\tlet stStep = null;\n\tlet last   = 0;\n\n\tasync function transition(idx, dir) {\n\t\t[idx, dir] = getIdxDir(idx, dir);\n\n\t\tconst t = window.performance.now();\n\t\tif (dir !== 0 && t - last < timeTran * 1000) return;\n\t\tlast = t;\n\n\t\tfor (let i = 0; i < slides.length; i += 1) {\n\t\t\tpics[i].transition((i % size) === idx, size);\n\t\t}\n\t\tawait effect.transition(idx, dir);\n\t\tif (onTransitionEnd) onTransitionEnd();\n\t\tcurIdx = idx;\n\t\tdisplay(idx);\n\t}\n\n\tasync function display(idx) {\n\t\tfor (let i = 0; i < slides.length; i += 1) {\n\t\t\tpics[i].display((i % size) === idx);\n\t\t}\n\t\tif (size === 1) return;\n\n\t\tconst dt = pics[idx].getDuration(timeDur, timeTran, randomTiming);\n\t\tif (stStep) stStep.clear();\n\t\tstStep = asyncTimeout(Math.ceil(dt * 1000), step);\n\t\tawait stStep.set();\n\t}\n\n\tasync function step() {\n\t\tif (root.classList.contains(CLS_VIEW) && !root.classList.contains(CLS_PAUSE)) {\n\t\t\ttransition(null, 1);\n\t\t} else {\n\t\t\tasyncTimeout(timeDur * 1000, step).set();\n\t\t}\n\t}\n\n\tfunction getIdxDir(idx, dir) {\n\t\tif (idx === null) {\n\t\t\tidx = curIdx + dir;\n\t\t\tif (size - 1 < idx) idx = 0;\n\t\t\tif (idx < 0) idx = size - 1;\n\t\t} else if (dir === 0) {\n\t\t\tif (curIdx < idx) {\n\t\t\t\tdir = 1;\n\t\t\t\tif ((curIdx - (idx - size)) < (idx - curIdx)) dir = -1;\n\t\t\t}\n\t\t\tif (idx < curIdx) {\n\t\t\t\tdir = -1;\n\t\t\t\tif (((idx + size) - curIdx) < (curIdx - idx)) dir = 1;\n\t\t\t}\n\t\t}\n\t\treturn [idx, dir];\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\treturn {\n\t\tnext           : () => { transition((curIdx === size - 1) ? 0   : (curIdx + 1),  1); },\n\t\tprevious       : () => { transition((curIdx === 0) ? (size - 1) : (curIdx - 1), -1); },\n\t\tonTransitionEnd: (fn) => { onTransitionEnd = fn; }\n\t};\n\n}\n"]}